<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>⚾ NPB 선수 이름 번역기</title>
    <style>
        /* 기본 스타일 및 폰트 설정 */
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap');
        
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #f0f2f5;
            color: #1c1e21;
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
        }

        /* 메인 컨테이너 스타일 */
        .container {
            width: 100%;
            max-width: 680px;
            background: #ffffff;
            padding: 24px 32px;
            border-radius: 12px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08);
            text-align: center;
        }

        /* 헤더 스타일 */
        header h1 {
            font-size: 2rem;
            color: #1877f2;
            margin-bottom: 24px;
        }

        /* 탭 버튼 스타일 */
        .tab-buttons {
            display: flex;
            border-bottom: 1px solid #dddfe2;
            margin-bottom: 24px;
        }

        .tab-button {
            flex: 1;
            padding: 14px;
            border: none;
            background: none;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            color: #606770;
            border-bottom: 3px solid transparent;
            transition: color 0.2s, border-color 0.2s;
        }

        .tab-button:hover {
            background-color: #f0f2f5;
        }

        .tab-button.active {
            color: #1877f2;
            border-bottom-color: #1877f2;
        }

        /* 뷰(화면) 전환 스타일 */
        .view {
            display: none;
        }

        .view.active {
            display: block;
        }

        /* 입력 요소 스타일 */
        textarea, input[type="text"] {
            width: 100%;
            padding: 12px;
            margin-bottom: 12px;
            border: 1px solid #dddfe2;
            border-radius: 8px;
            box-sizing: border-box;
            font-size: 1rem;
            font-family: 'Noto Sans KR', sans-serif;
        }

        textarea {
            min-height: 150px;
            resize: vertical;
        }

        /* 버튼 스타일 */
        .button-group {
            display: flex;
            gap: 10px;
        }
        
        .action-button {
            width: 100%;
            padding: 14px;
            background: linear-gradient(45deg, #1877f2, #3b5998);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            flex-grow: 1;
        }

        .action-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.15);
        }
        
        .refresh-button {
            padding: 14px 20px;
            background-color: #6c757d;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .refresh-button:hover {
            background-color: #5a6268;
        }

        .secondary-button {
            width: 100%;
            padding: 12px;
            background-color: #28a745; /* 초록색으로 변경 */
            color: white; /* 흰색 글자로 변경 */
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .secondary-button:hover {
            background-color: #218838; /* 더 진한 초록색으로 변경 */
        }

        /* 결과 표시 영역 스타일 */
        .result-box {
            margin-top: 20px;
            padding: 15px;
            background-color: #f0f2f5;
            border-radius: 8px;
            min-height: 24px;
            font-size: 1.1rem;
            text-align: left;
            white-space: pre-wrap;
            word-wrap: break-word;
            line-height: 1.6;
        }
        
        /* 로딩 스피너 스타일 */
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #1877f2;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
            display: none;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Modal (팝업) 스타일 */
        .modal {
            display: none;
            position: fixed;
            z-index: 100;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background-color: #fefefe;
            margin: 10% auto;
            padding: 20px 30px;
            border: 1px solid #888;
            width: 90%;
            max-width: 600px;
            border-radius: 12px;
            position: relative;
            box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2),0 6px 20px 0 rgba(0,0,0,0.19);
        }

        .close-button {
            color: #aaa;
            position: absolute;
            top: 10px;
            right: 20px;
            font-size: 28px;
            font-weight: bold;
        }

        .close-button:hover,
        .close-button:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }
    </style>
</head>
<body>

    <div class="container">
        <header>
            <h1>⚾ NPB 선수 이름 번역기</h1>
        </header>

        <div class="tab-buttons">
            <button class="tab-button active" onclick="switchView('translate')">번역하기</button>
            <button class="tab-button" onclick="switchView('add')">선수 추가</button>
        </div>

        <!-- 번역하기 뷰 -->
        <div id="translate-view" class="view active">
            <textarea id="japanese-input" placeholder="번역할 선수들의 일본어 이름을 한 줄에 한 명씩 입력하세요..."></textarea>
            <div class="button-group">
                <button class="action-button" onclick="translateText()">번역하기</button>
                <button class="refresh-button" onclick="refreshTranslationView()">새로고침</button>
            </div>
            <div class="loader" id="translate-loader"></div>
            <div id="translation-result" class="result-box">번역 결과가 여기에 표시됩니다.</div>
        </div>

        <!-- 선수 추가 뷰 -->
        <div id="add-view" class="view">
            <input type="text" id="add-japanese-single" placeholder="일본어 이름 (예: 大谷 翔平)">
            <input type="text" id="add-korean-single" placeholder="한국어 이름 (예: 오타니 쇼헤이)">
            <button class="action-button" onclick="addSingleTranslation()">선수 추가</button>
            <div id="add-result" class="result-box"></div>
            <hr style="margin: 20px 0;">
            <button class="secondary-button" onclick="openModal()">여러 선수 한번에 추가하기</button>
        </div>
    </div>

    <!-- 여러 선수 추가 팝업 (Modal) -->
    <div id="multiple-add-modal" class="modal">
        <div class="modal-content">
            <span class="close-button" onclick="closeModal()">&times;</span>
            <h2 style="text-align: center;">여러 선수 추가</h2>
            <p style="text-align: center; color: #606770;">아래 형식으로 여러 선수를 추가할 수 있습니다. (한 줄에 한 명)</p>
            <textarea id="add-multiple-input" placeholder="일본어이름1,한국어이름1&#10;大谷 翔平,오타니 쇼헤이&#10;山本 由伸,야마모토 요시노부"></textarea>
            <button class="action-button" onclick="addMultipleTranslations()">추가하기</button>
            <div id="add-multiple-result" class="result-box"></div>
        </div>
    </div>


    <!-- Firebase SDK 추가 -->
    <script type="module">
        // Firebase 버전 9 모듈식 SDK 임포트
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
        import { getFirestore, collection, query, where, getDocs, doc, serverTimestamp, writeBatch, addDoc } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore.js";

        // --- Firebase 설정 ---
        const firebaseConfig = {
          apiKey: "AIzaSyDaATI_WkM0byU3t21vtetJjF2q-qmlRRw",
          authDomain: "npbtokorv2.firebaseapp.com",
          projectId: "npbtokorv2",
          storageBucket: "npbtokorv2.firebasestorage.app",
          messagingSenderId: "881007768515",
          appId: "1:881007768515:web:04da0b8e40747cf92b8376",
          measurementId: "G-2F7Z102KX6"
        };

        // --- 설정 확인 및 초기화 ---
        if (!firebaseConfig.projectId || firebaseConfig.projectId === "your-project-id") {
            const container = document.querySelector('.container');
            container.innerHTML = `<div style="padding: 20px; background-color: #ffebee; border: 1px solid #c62828; border-radius: 8px; color: #c62828; text-align: left;"><h2 style="margin-top: 0;">🔥 Firebase 설정 오류 🔥</h2><p>프로그램을 실행하려면 Firebase 설정이 필요합니다.</p><p>HTML 코드의 <b>firebaseConfig</b> 객체를 당신의 Firebase 프로젝트 설정 값으로 교체해주세요.</p></div>`;
        } else {
            const app = initializeApp(firebaseConfig);
            const db = getFirestore(app);
            const translationsCol = collection(db, "translations");

            window.switchView = (viewName) => {
                document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
                document.querySelectorAll('.tab-button').forEach(b => b.classList.remove('active'));
                document.getElementById(`${viewName}-view`).classList.add('active');
                document.querySelector(`button[onclick="switchView('${viewName}')"]`).classList.add('active');
            };

            const showLoader = (loaderId, show) => {
                document.getElementById(loaderId).style.display = show ? 'block' : 'none';
            };

            // Modal 제어 함수
            const modal = document.getElementById('multiple-add-modal');
            window.openModal = () => { modal.style.display = 'block'; };
            window.closeModal = () => { modal.style.display = 'none'; };
            window.onclick = (event) => {
                if (event.target == modal) {
                    modal.style.display = 'none';
                }
            };
            
            // 번역 뷰 초기화 함수
            window.refreshTranslationView = () => {
                const japaneseInput = document.getElementById('japanese-input');
                const resultDiv = document.getElementById('translation-result');
                japaneseInput.value = '';
                resultDiv.innerText = '번역 결과가 여기에 표시됩니다.';
                resultDiv.style.color = '#606770';
            };

            // 여러 선수 번역 기능 함수
            window.translateText = async () => {
                const japaneseInput = document.getElementById('japanese-input').value.trim();
                const resultDiv = document.getElementById('translation-result');
                
                if (!japaneseInput) {
                    resultDiv.innerText = '번역할 내용을 입력해주세요.';
                    resultDiv.style.color = 'red';
                    return;
                }

                showLoader('translate-loader', true);
                resultDiv.style.display = 'none';

                const names = japaneseInput.split('\n').map(name => name.trim()).filter(name => name);
                const resultsMap = new Map();
                names.forEach(name => resultsMap.set(name, '(찾을 수 없음)'));

                try {
                    // Firestore 'in' 쿼리 제한(10)에 맞춰 10개씩 나눠서 처리
                    for (let i = 0; i < names.length; i += 10) {
                        const chunk = names.slice(i, i + 10);
                        if (chunk.length > 0) {
                            const q = query(translationsCol, where("japanese", "in", chunk));
                            const querySnapshot = await getDocs(q);
                            querySnapshot.forEach(doc => {
                                const data = doc.data();
                                resultsMap.set(data.japanese, data.korean);
                            });
                        }
                    }

                    const results = names.map(name => resultsMap.get(name));
                    resultDiv.innerText = results.join('\n');
                    resultDiv.style.color = '#2c3e50';

                } catch (error) {
                    console.error("번역 중 오류 발생: ", error);
                    resultDiv.innerText = '오류가 발생했습니다. 잠시 후 다시 시도해주세요.';
                    resultDiv.style.color = 'red';
                } finally {
                    showLoader('translate-loader', false);
                    resultDiv.style.display = 'block';
                }
            };
            
            // 단일 선수 추가 함수
            window.addSingleTranslation = async () => {
                const japanese = document.getElementById('add-japanese-single').value.trim();
                const korean = document.getElementById('add-korean-single').value.trim();
                const resultDiv = document.getElementById('add-result');

                if (!japanese || !korean) {
                    resultDiv.innerText = '일본어와 한국어 이름을 모두 입력해주세요.';
                    resultDiv.style.color = 'red';
                    return;
                }
                
                try {
                    const q = query(translationsCol, where("japanese", "==", japanese));
                    const querySnapshot = await getDocs(q);

                    if (!querySnapshot.empty) {
                        resultDiv.innerText = '이미 등록된 선수입니다.';
                        resultDiv.style.color = '#f39c12';
                        return;
                    }

                    await addDoc(translationsCol, {
                        japanese: japanese,
                        korean: korean,
                        createdAt: serverTimestamp()
                    });

                    resultDiv.innerText = `✅ ${korean}(${japanese}) 선수가 성공적으로 추가되었습니다!`;
                    resultDiv.style.color = '#2ecc71';
                    document.getElementById('add-japanese-single').value = '';
                    document.getElementById('add-korean-single').value = '';

                } catch (error) {
                    console.error("단일 선수 추가 중 오류 발생: ", error);
                    resultDiv.innerText = '오류가 발생했습니다. 잠시 후 다시 시도해주세요.';
                    resultDiv.style.color = 'red';
                }
            };

            // 여러 선수 추가 함수 (팝업용)
            window.addMultipleTranslations = async () => {
                const multipleInput = document.getElementById('add-multiple-input').value.trim();
                const resultDiv = document.getElementById('add-multiple-result');

                if (!multipleInput) {
                    resultDiv.innerText = '추가할 선수 정보를 입력해주세요.';
                    resultDiv.style.color = 'red';
                    return;
                }

                const lines = multipleInput.split('\n').filter(line => line.trim() !== '');
                const playersToAdd = [];
                const invalidLines = [];

                for (const line of lines) {
                    const parts = line.split(',').map(p => p.trim());
                    if (parts.length === 2 && parts[0] && parts[1]) {
                        playersToAdd.push({ japanese: parts[0], korean: parts[1] });
                    } else {
                        invalidLines.push(line);
                    }
                }

                if (playersToAdd.length === 0) {
                    resultDiv.innerText = '올바른 형식(일본어이름,한국어이름)으로 입력해주세요.';
                    resultDiv.style.color = 'red';
                    return;
                }

                try {
                    let addedCount = 0;
                    let duplicateCount = 0;
                    
                    const allJapaneseNames = playersToAdd.map(p => p.japanese);
                    const existingNames = new Set();
                    
                    // Firestore 'in' 쿼리 제한(10)에 맞춰 10개씩 나눠서 처리
                    for (let i = 0; i < allJapaneseNames.length; i += 10) {
                        const chunk = allJapaneseNames.slice(i, i + 10);
                        if (chunk.length > 0) {
                            const q = query(translationsCol, where("japanese", "in", chunk));
                            const querySnapshot = await getDocs(q);
                            querySnapshot.forEach(doc => {
                                existingNames.add(doc.data().japanese);
                            });
                        }
                    }
                    
                    const batch = writeBatch(db);
                    for (const player of playersToAdd) {
                        if (existingNames.has(player.japanese)) {
                            duplicateCount++;
                        } else {
                            const newDocRef = doc(collection(db, "translations"));
                            batch.set(newDocRef, {
                                japanese: player.japanese,
                                korean: player.korean,
                                createdAt: serverTimestamp()
                            });
                            addedCount++;
                        }
                    }

                    if (addedCount > 0) {
                        await batch.commit();
                    }

                    let resultMessage = `✅ ${addedCount}명의 선수가 성공적으로 추가되었습니다.`;
                    if (duplicateCount > 0) {
                        resultMessage += `\n⚠️ ${duplicateCount}명은 이미 등록된 선수입니다.`;
                    }
                    if (invalidLines.length > 0) {
                        resultMessage += `\n❌ ${invalidLines.length}개의 줄이 형식에 맞지 않아 제외되었습니다.`;
                    }

                    resultDiv.innerText = resultMessage;
                    resultDiv.style.color = '#2c3e50';
                    document.getElementById('add-multiple-input').value = '';

                } catch (error) {
                    console.error("데이터 추가 중 오류 발생: ", error);
                    resultDiv.innerText = '오류가 발생했습니다. 잠시 후 다시 시도해주세요.';
                    resultDiv.style.color = 'red';
                }
            };
        }
    </script>
</body>
</html>
