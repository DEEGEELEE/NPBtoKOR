<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>âš¾ NPB ì„ ìˆ˜ ì´ë¦„ ë²ˆì—­ê¸°</title>
    <style>
        /* ê¸°ë³¸ ìŠ¤íƒ€ì¼ ë° í°íŠ¸ ì„¤ì • */
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap');
        
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #f0f2f5;
            color: #1c1e21;
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
        }

        /* ë©”ì¸ ì»¨í…Œì´ë„ˆ ìŠ¤íƒ€ì¼ */
        .container {
            width: 100%;
            max-width: 680px;
            background: #ffffff;
            padding: 24px 32px;
            border-radius: 12px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08);
            text-align: center;
        }

        /* í—¤ë” ìŠ¤íƒ€ì¼ */
        header h1 {
            font-size: 2rem;
            color: #1877f2;
            margin-bottom: 24px;
        }

        /* íƒ­ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .tab-buttons {
            display: flex;
            border-bottom: 1px solid #dddfe2;
            margin-bottom: 24px;
        }

        .tab-button {
            flex: 1;
            padding: 14px;
            border: none;
            background: none;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            color: #606770;
            border-bottom: 3px solid transparent;
            transition: color 0.2s, border-color 0.2s;
        }

        .tab-button:hover {
            background-color: #f0f2f5;
        }

        .tab-button.active {
            color: #1877f2;
            border-bottom-color: #1877f2;
        }

        /* ë·°(í™”ë©´) ì „í™˜ ìŠ¤íƒ€ì¼ */
        .view {
            display: none;
        }

        .view.active {
            display: block;
        }

        /* ì…ë ¥ ìš”ì†Œ ìŠ¤íƒ€ì¼ */
        textarea, input[type="text"] {
            width: 100%;
            padding: 12px;
            margin-bottom: 12px;
            border: 1px solid #dddfe2;
            border-radius: 8px;
            box-sizing: border-box;
            font-size: 1rem;
            font-family: 'Noto Sans KR', sans-serif;
        }

        textarea {
            min-height: 150px;
            resize: vertical;
        }

        /* ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .button-group {
            display: flex;
            gap: 10px;
        }
        
        .action-button {
            width: 100%;
            padding: 14px;
            background: linear-gradient(45deg, #1877f2, #3b5998);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            flex-grow: 1;
        }

        .action-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.15);
        }
        
        .refresh-button {
            padding: 14px 20px;
            background-color: #6c757d;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            transition: background-color 0.2s;
            white-space: nowrap; /* ê¸€ì ì¤„ë°”ê¿ˆ ë°©ì§€ */
        }

        .refresh-button:hover {
            background-color: #5a6268;
        }

        .secondary-button {
            width: 100%;
            padding: 12px;
            background-color: #28a745; /* ì´ˆë¡ìƒ‰ìœ¼ë¡œ ë³€ê²½ */
            color: white; /* í°ìƒ‰ ê¸€ìë¡œ ë³€ê²½ */
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .secondary-button:hover {
            background-color: #218838; /* ë” ì§„í•œ ì´ˆë¡ìƒ‰ìœ¼ë¡œ ë³€ê²½ */
        }
        
        .edit-button {
             background: none;
             border: 1px solid #6c757d;
             color: #6c757d;
             padding: 4px 8px;
             font-size: 0.8rem;
             border-radius: 5px;
             cursor: pointer;
             margin-left: 10px;
        }

        /* ê²°ê³¼ í‘œì‹œ ì˜ì—­ ìŠ¤íƒ€ì¼ */
        .result-box {
            margin-top: 20px;
            padding: 15px;
            background-color: #f0f2f5;
            border-radius: 8px;
            min-height: 24px;
            font-size: 1.0rem; /* ê¸€ì”¨ í¬ê¸° ìˆ˜ì • */
            text-align: left;
            white-space: pre-wrap;
            word-wrap: break-word;
            line-height: 1.6;
        }
        
        .result-box hr {
            border: 0;
            height: 1px;
            background-color: #dddfe2;
            margin: 10px 0;
        }
        
        .result-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 5px 0;
        }

        .result-item > div {
            display: flex;
            align-items: center;
        }

        .japanese-name {
            color: #606770;
        }

        .korean-name {
            color: #1877f2;
            font-weight: 700;
            margin-left: 10px;
        }
        
        /* ë¡œë”© ìŠ¤í”¼ë„ˆ ìŠ¤íƒ€ì¼ */
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #1877f2;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
            display: none;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Modal (íŒì—…) ìŠ¤íƒ€ì¼ */
        .modal {
            display: none;
            position: fixed;
            z-index: 100;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background-color: #fefefe;
            margin: 10% auto;
            padding: 20px 30px;
            border: 1px solid #888;
            width: 90%;
            max-width: 600px;
            border-radius: 12px;
            position: relative;
            box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2),0 6px 20px 0 rgba(0,0,0,0.19);
        }

        .close-button {
            color: #aaa;
            position: absolute;
            top: 10px;
            right: 20px;
            font-size: 28px;
            font-weight: bold;
        }

        .close-button:hover,
        .close-button:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }

        .multiple-add-container {
            display: flex;
            gap: 10px;
        }

        .multiple-add-container textarea {
            flex: 1;
            min-height: 200px;
        }
    </style>
</head>
<body>

    <div class="container">
        <header>
            <h1>âš¾ NPB ì„ ìˆ˜ ì´ë¦„ ë²ˆì—­ê¸°</h1>
        </header>

        <div class="tab-buttons">
            <button class="tab-button active" onclick="switchView('translate')">ë²ˆì—­í•˜ê¸°</button>
            <button class="tab-button" onclick="switchView('add')">ì„ ìˆ˜ ì¶”ê°€</button>
        </div>

        <!-- ë²ˆì—­í•˜ê¸° ë·° -->
        <div id="translate-view" class="view active">
            <textarea id="japanese-input" placeholder="ê²€ìƒ‰í•  ì„ ìˆ˜ë“¤ì˜ ì¼ë³¸ì–´ ì´ë¦„ì„ í•œ ì¤„ì— í•œ ëª…ì”© ì…ë ¥í•˜ì„¸ìš”..."></textarea>
            <div class="button-group">
                <button class="action-button" onclick="translateText()">ë²ˆì—­í•˜ê¸°</button>
                <button class="refresh-button" onclick="refreshTranslationView()">ìƒˆë¡œê³ ì¹¨</button>
            </div>
            <div class="loader" id="translate-loader"></div>
            <div id="translation-result" class="result-box">ë²ˆì—­ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</div>
        </div>

        <!-- ì„ ìˆ˜ ì¶”ê°€ ë·° -->
        <div id="add-view" class="view">
            <input type="text" id="add-japanese-single" placeholder="ì¼ë³¸ì–´ ì´ë¦„ (ì˜ˆ: å¤§è°· ç¿”å¹³)">
            <input type="text" id="add-korean-single" placeholder="í•œêµ­ì–´ ì´ë¦„ (ì˜ˆ: ì˜¤íƒ€ë‹ˆ ì‡¼í—¤ì´)">
            <button class="action-button" onclick="addSingleTranslation()">ì„ ìˆ˜ ì¶”ê°€</button>
            <div id="add-result" class="result-box"></div>
            <hr style="margin: 20px 0;">
            <button class="secondary-button" onclick="openModal('multiple-add-modal')">ì—¬ëŸ¬ ì„ ìˆ˜ í•œë²ˆì— ì¶”ê°€í•˜ê¸°</button>
        </div>
    </div>

    <!-- ì—¬ëŸ¬ ì„ ìˆ˜ ì¶”ê°€ íŒì—… -->
    <div id="multiple-add-modal" class="modal">
        <div class="modal-content">
            <span class="close-button" onclick="closeModal('multiple-add-modal')">&times;</span>
            <h2 style="text-align: center;">ì—¬ëŸ¬ ì„ ìˆ˜ ì¶”ê°€</h2>
            <p style="text-align: center; color: #606770;">ì–‘ìª½ ì¹¸ì— ì„ ìˆ˜ ì´ë¦„ì„ í•œ ì¤„ì— í•œ ëª…ì”© ìˆœì„œëŒ€ë¡œ ì…ë ¥í•˜ì„¸ìš”.</p>
            <div class="multiple-add-container">
                <textarea id="add-multiple-japanese" placeholder="ì¼ë³¸ì–´ ì´ë¦„&#10;å¤§è°· ç¿”å¹³&#10;å±±æœ¬ ç”±ä¼¸"></textarea>
                <textarea id="add-multiple-korean" placeholder="í•œêµ­ì–´ ì´ë¦„&#10;ì˜¤íƒ€ë‹ˆ ì‡¼í—¤ì´&#10;ì•¼ë§ˆëª¨í†  ìš”ì‹œë…¸ë¶€"></textarea>
            </div>
            <button class="action-button" onclick="addMultipleTranslations()">ì¶”ê°€í•˜ê¸°</button>
            <div id="add-multiple-result" class="result-box"></div>
        </div>
    </div>
    
    <!-- ì„ ìˆ˜ ì •ë³´ ìˆ˜ì • íŒì—… -->
    <div id="edit-player-modal" class="modal">
        <div class="modal-content">
            <span class="close-button" onclick="closeModal('edit-player-modal')">&times;</span>
            <h2 style="text-align: center;">ì„ ìˆ˜ ì •ë³´ ìˆ˜ì •</h2>
            <input type="hidden" id="edit-doc-id">
            <input type="text" id="edit-japanese-name" placeholder="ì¼ë³¸ì–´ ì´ë¦„">
            <input type="text" id="edit-korean-name" placeholder="í•œêµ­ì–´ ì´ë¦„">
            <div class="button-group">
                <button class="action-button" onclick="saveChanges()">ì €ì¥</button>
                <button class="refresh-button" style="background-color: #dc3545;" onclick="deletePlayer()">ì‚­ì œ</button>
            </div>
            <div id="edit-result" class="result-box"></div>
        </div>
    </div>


    <!-- Firebase SDK ì¶”ê°€ -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
        import { getFirestore, collection, query, where, getDocs, doc, serverTimestamp, writeBatch, addDoc, updateDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore.js";

        // --- Firebase ì„¤ì • ---
        const firebaseConfig = {
          apiKey: "AIzaSyDaATI_WkM0byU3t21vtetJjF2q-qmlRRw",
          authDomain: "npbtokorv2.firebaseapp.com",
          projectId: "npbtokorv2",
          storageBucket: "npbtokorv2.firebasestorage.app",
          messagingSenderId: "881007768515",
          appId: "1:881007768515:web:04da0b8e40747cf92b8376",
          measurementId: "G-2F7Z102KX6"
        };

        // --- ì„¤ì • í™•ì¸ ë° ì´ˆê¸°í™” ---
        if (!firebaseConfig.projectId || firebaseConfig.projectId === "your-project-id") {
            const container = document.querySelector('.container');
            container.innerHTML = `<div style="padding: 20px; background-color: #ffebee; border: 1px solid #c62828; border-radius: 8px; color: #c62828; text-align: left;"><h2 style="margin-top: 0;">ğŸ”¥ Firebase ì„¤ì • ì˜¤ë¥˜ ğŸ”¥</h2><p>í”„ë¡œê·¸ë¨ì„ ì‹¤í–‰í•˜ë ¤ë©´ Firebase ì„¤ì •ì´ í•„ìš”í•©ë‹ˆë‹¤.</p><p>HTML ì½”ë“œì˜ <b>firebaseConfig</b> ê°ì²´ë¥¼ ë‹¹ì‹ ì˜ Firebase í”„ë¡œì íŠ¸ ì„¤ì • ê°’ìœ¼ë¡œ êµì²´í•´ì£¼ì„¸ìš”.</p></div>`;
        } else {
            const app = initializeApp(firebaseConfig);
            const db = getFirestore(app);
            const translationsCol = collection(db, "translations");
            let temporaryEditData = {}; // ìˆ˜ì •í•  ë°ì´í„°ë¥¼ ì„ì‹œ ì €ì¥í•˜ëŠ” ê°ì²´

            window.switchView = (viewName) => {
                document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
                document.querySelectorAll('.tab-button').forEach(b => b.classList.remove('active'));
                document.getElementById(`${viewName}-view`).classList.add('active');
                document.querySelector(`button[onclick="switchView('${viewName}')"]`).classList.add('active');
            };

            const showLoader = (loaderId, show) => {
                document.getElementById(loaderId).style.display = show ? 'block' : 'none';
            };

            // Modal ì œì–´ í•¨ìˆ˜
            window.openModal = (modalId) => { document.getElementById(modalId).style.display = 'block'; };
            window.closeModal = (modalId) => { document.getElementById(modalId).style.display = 'none'; };
            window.onclick = (event) => {
                if (event.target.classList.contains('modal')) {
                    event.target.style.display = 'none';
                }
            };
            
            // ë²ˆì—­ ë·° ì´ˆê¸°í™” í•¨ìˆ˜
            window.refreshTranslationView = () => {
                const japaneseInput = document.getElementById('japanese-input');
                const resultDiv = document.getElementById('translation-result');
                japaneseInput.value = '';
                resultDiv.innerHTML = 'ë²ˆì—­ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.';
                resultDiv.style.color = '#606770';
            };

            // ê²€ìƒ‰ í‚¤ì›Œë“œ ìƒì„± í•¨ìˆ˜
            const createKeywords = (name) => {
                const keywords = new Set();
                const normalizedName = name.normalize('NFKC');
                keywords.add(normalizedName);
                
                normalizedName.split(/[ãƒ»\sã€€.ï¼,]/).forEach(word => {
                    if (word) keywords.add(word);
                });
                return Array.from(keywords);
            };

            // ë¶€ë¶„ ê²€ìƒ‰ ê¸°ëŠ¥ í•¨ìˆ˜
            window.translateText = async () => {
                const japaneseInput = document.getElementById('japanese-input').value.trim();
                const resultDiv = document.getElementById('translation-result');
                
                if (!japaneseInput) {
                    resultDiv.innerText = 'ê²€ìƒ‰í•  ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.';
                    resultDiv.style.color = 'red';
                    return;
                }

                showLoader('translate-loader', true);
                resultDiv.style.display = 'none';

                const names = japaneseInput.split('\n').map(name => name.trim()).filter(name => name);

                try {
                    const searchPromises = names.map(name => {
                        const q = query(translationsCol, where("search_keywords", "array-contains", name));
                        return getDocs(q);
                    });

                    const snapshots = await Promise.all(searchPromises);
                    
                    temporaryEditData = {}; // ê²€ìƒ‰í•  ë•Œë§ˆë‹¤ ì„ì‹œ ë°ì´í„° ì´ˆê¸°í™”

                    const resultBlocks = [];
                    snapshots.forEach((snapshot) => {
                        if (!snapshot.empty) {
                            const foundPlayers = snapshot.docs.map(doc => {
                                const data = doc.data();
                                const docId = doc.id;
                                // ì„ì‹œ ì €ì¥ì†Œì— ë°ì´í„° ì €ì¥
                                temporaryEditData[docId] = { japanese: data.japanese, korean: data.korean };
                                return `<div class="result-item">
                                            <div>
                                                <span class="japanese-name">${data.japanese}</span>
                                                <span class="korean-name">${data.korean}</span>
                                            </div>
                                            <button class="edit-button" onclick="openEditModal('${docId}')">ìˆ˜ì •</button>
                                        </div>`;
                            }).join('');
                            resultBlocks.push(foundPlayers);
                        }
                    });

                    if (resultBlocks.length === 0) {
                        resultDiv.innerHTML = '(ì°¾ì„ ìˆ˜ ì—†ìŒ)';
                    } else {
                        resultDiv.innerHTML = resultBlocks.join('<hr>');
                    }
                    
                    resultDiv.style.color = '#2c3e50';

                } catch (error) {
                    console.error("ê²€ìƒ‰ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: ", error);
                    if (error.code === 'failed-precondition') {
                        resultDiv.innerHTML = `<strong>ë°ì´í„°ë² ì´ìŠ¤ ì˜¤ë¥˜</strong><br>ê²€ìƒ‰ì— í•„ìš”í•œ ìƒ‰ì¸(index)ì´ ì—†ìŠµë‹ˆë‹¤. <br>ë¸Œë¼ìš°ì €ì˜ ê°œë°œì ë„êµ¬(F12) ì½˜ì†”ì„ ì—´ì–´ë³´ì‹œë©´ Firebaseê°€ ì œê³µí•˜ëŠ” ìƒ‰ì¸ ìƒì„± ë§í¬ë¥¼ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. í•´ë‹¹ ë§í¬ë¥¼ í´ë¦­í•˜ì—¬ ìƒ‰ì¸ì„ ë§Œë“¤ì–´ì£¼ì„¸ìš”.`;
                    } else {
                        resultDiv.innerText = 'ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.';
                    }
                    resultDiv.style.color = 'red';
                } finally {
                    showLoader('translate-loader', false);
                    resultDiv.style.display = 'block';
                }
            };
            
            // ìˆ˜ì • íŒì—… ì—´ê¸° (ìˆ˜ì •ë¨)
            window.openEditModal = (docId) => {
                const data = temporaryEditData[docId];
                if (!data) {
                    console.error("ìˆ˜ì •í•  ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤:", docId);
                    alert("ì˜¤ë¥˜: ìˆ˜ì •í•  ì„ ìˆ˜ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
                    return;
                }
                document.getElementById('edit-doc-id').value = docId;
                document.getElementById('edit-japanese-name').value = data.japanese;
                document.getElementById('edit-korean-name').value = data.korean;
                document.getElementById('edit-result').innerText = '';
                openModal('edit-player-modal');
            };

            // ë³€ê²½ì‚¬í•­ ì €ì¥
            window.saveChanges = async () => {
                const docId = document.getElementById('edit-doc-id').value;
                const newJapanese = document.getElementById('edit-japanese-name').value.trim();
                const newKorean = document.getElementById('edit-korean-name').value.trim();
                const resultDiv = document.getElementById('edit-result');

                if (!newJapanese || !newKorean) {
                    resultDiv.innerText = "ì´ë¦„ì„ ë¹„ì›Œë‘˜ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.";
                    resultDiv.style.color = 'red';
                    return;
                }

                const playerRef = doc(db, "translations", docId);
                const newKeywords = createKeywords(newJapanese);

                try {
                    await updateDoc(playerRef, {
                        japanese: newJapanese,
                        korean: newKorean,
                        search_keywords: newKeywords
                    });
                    resultDiv.innerText = "ì„±ê³µì ìœ¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.";
                    resultDiv.style.color = 'green';
                    setTimeout(() => {
                        closeModal('edit-player-modal');
                        translateText(); // ê²°ê³¼ ìƒˆë¡œê³ ì¹¨
                    }, 1000);
                } catch (error) {
                    console.error("ì—…ë°ì´íŠ¸ ì˜¤ë¥˜:", error);
                    resultDiv.innerText = "ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.";
                    resultDiv.style.color = 'red';
                }
            };

            // ì„ ìˆ˜ ì‚­ì œ (ìˆ˜ì •ë¨)
            window.deletePlayer = () => {
                const japaneseName = document.getElementById('edit-japanese-name').value;
                const resultDiv = document.getElementById('edit-result');
                
                resultDiv.innerHTML = `<strong>${japaneseName}</strong> ì„ ìˆ˜ë¥¼ ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? <br/>
                    <button id="confirm-delete-btn" style="background-color: #dc3545; color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer; margin-top: 10px;">ë„¤, ì‚­ì œí•©ë‹ˆë‹¤</button>`;
                
                document.getElementById('confirm-delete-btn').onclick = () => {
                    const docId = document.getElementById('edit-doc-id').value;
                    confirmDelete(docId);
                };
            };
            
            const confirmDelete = async (docId) => {
                 const resultDiv = document.getElementById('edit-result');
                 try {
                    await deleteDoc(doc(db, "translations", docId));
                    resultDiv.innerText = "ì„±ê³µì ìœ¼ë¡œ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.";
                    resultDiv.style.color = 'green';
                    setTimeout(() => {
                        closeModal('edit-player-modal');
                        translateText(); // ê²°ê³¼ ìƒˆë¡œê³ ì¹¨
                    }, 1000);
                 } catch (error) {
                    console.error("ì‚­ì œ ì˜¤ë¥˜:", error);
                    resultDiv.innerText = "ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.";
                    resultDiv.style.color = 'red';
                 }
            };
            
            // ë‹¨ì¼ ì„ ìˆ˜ ì¶”ê°€ í•¨ìˆ˜
            window.addSingleTranslation = async () => {
                const japanese = document.getElementById('add-japanese-single').value.trim();
                const korean = document.getElementById('add-korean-single').value.trim();
                const resultDiv = document.getElementById('add-result');

                if (!japanese || !korean) {
                    resultDiv.innerText = 'ì¼ë³¸ì–´ì™€ í•œêµ­ì–´ ì´ë¦„ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.';
                    resultDiv.style.color = 'red';
                    return;
                }
                
                try {
                    const q = query(translationsCol, where("japanese", "==", japanese));
                    const querySnapshot = await getDocs(q);

                    if (!querySnapshot.empty) {
                        resultDiv.innerText = 'ì´ë¯¸ ë“±ë¡ëœ ì„ ìˆ˜ì…ë‹ˆë‹¤.';
                        resultDiv.style.color = '#f39c12';
                        return;
                    }

                    const keywords = createKeywords(japanese);

                    await addDoc(translationsCol, {
                        japanese: japanese,
                        korean: korean,
                        search_keywords: keywords,
                        createdAt: serverTimestamp()
                    });

                    resultDiv.innerText = `âœ… ${korean}(${japanese}) ì„ ìˆ˜ê°€ ì„±ê³µì ìœ¼ë¡œ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!`;
                    resultDiv.style.color = '#2ecc71';
                    document.getElementById('add-japanese-single').value = '';
                    document.getElementById('add-korean-single').value = '';

                } catch (error) {
                    console.error("ë‹¨ì¼ ì„ ìˆ˜ ì¶”ê°€ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: ", error);
                    resultDiv.innerText = 'ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.';
                    resultDiv.style.color = 'red';
                }
            };

            // ì—¬ëŸ¬ ì„ ìˆ˜ ì¶”ê°€ í•¨ìˆ˜ (íŒì—…ìš©)
            window.addMultipleTranslations = async () => {
                const japaneseInput = document.getElementById('add-multiple-japanese').value.trim();
                const koreanInput = document.getElementById('add-multiple-korean').value.trim();
                const resultDiv = document.getElementById('add-multiple-result');

                if (!japaneseInput || !koreanInput) {
                    resultDiv.innerText = 'ì–‘ìª½ ì¹¸ì— ì¶”ê°€í•  ì„ ìˆ˜ ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.';
                    resultDiv.style.color = 'red';
                    return;
                }

                const japaneseLines = japaneseInput.split('\n').filter(line => line.trim() !== '');
                const koreanLines = koreanInput.split('\n').filter(line => line.trim() !== '');

                if (japaneseLines.length !== koreanLines.length) {
                    resultDiv.innerText = 'ì¼ë³¸ì–´ì™€ í•œêµ­ì–´ ì´ë¦„ì˜ ì¤„ ìˆ˜ê°€ ë§ì§€ ì•ŠìŠµë‹ˆë‹¤. í™•ì¸í•´ì£¼ì„¸ìš”.';
                    resultDiv.style.color = 'red';
                    return;
                }

                const playersToAdd = japaneseLines.map((jpName, index) => ({
                    japanese: jpName.trim(),
                    korean: koreanLines[index].trim()
                }));

                if (playersToAdd.length === 0) {
                    resultDiv.innerText = 'ì¶”ê°€í•  ì„ ìˆ˜ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.';
                    resultDiv.style.color = 'red';
                    return;
                }

                try {
                    let addedCount = 0;
                    let duplicateCount = 0;
                    
                    const allJapaneseNames = playersToAdd.map(p => p.japanese);
                    const existingNames = new Set();
                    
                    for (let i = 0; i < allJapaneseNames.length; i += 10) {
                        const chunk = allJapaneseNames.slice(i, i + 10);
                        if (chunk.length > 0) {
                            const q = query(translationsCol, where("japanese", "in", chunk));
                            const querySnapshot = await getDocs(q);
                            querySnapshot.forEach(doc => {
                                existingNames.add(doc.data().japanese);
                            });
                        }
                    }
                    
                    const batch = writeBatch(db);
                    for (const player of playersToAdd) {
                        if (existingNames.has(player.japanese)) {
                            duplicateCount++;
                        } else {
                            const keywords = createKeywords(player.japanese);
                            const newDocRef = doc(collection(db, "translations"));
                            batch.set(newDocRef, {
                                japanese: player.japanese,
                                korean: player.korean,
                                search_keywords: keywords,
                                createdAt: serverTimestamp()
                            });
                            addedCount++;
                        }
                    }

                    if (addedCount > 0) {
                        await batch.commit();
                    }

                    let resultMessage = `âœ… ${addedCount}ëª…ì˜ ì„ ìˆ˜ê°€ ì„±ê³µì ìœ¼ë¡œ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.`;
                    if (duplicateCount > 0) {
                        resultMessage += `\nâš ï¸ ${duplicateCount}ëª…ì€ ì´ë¯¸ ë“±ë¡ëœ ì„ ìˆ˜ì…ë‹ˆë‹¤.`;
                    }

                    resultDiv.innerText = resultMessage;
                    resultDiv.style.color = '#2c3e50';
                    document.getElementById('add-multiple-japanese').value = '';
                    document.getElementById('add-multiple-korean').value = '';

                } catch (error) {
                    console.error("ë°ì´í„° ì¶”ê°€ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: ", error);
                    resultDiv.innerText = 'ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.';
                    resultDiv.style.color = 'red';
                }
            };
        }
    </script>
</body>
</html>
